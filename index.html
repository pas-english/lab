<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Jackie's Lab</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background: #f0f4f8; }
        .box { background: white; padding: 20px; border-radius: 15px; width: 100%; max-width: 400px; display: inline-block; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        img { width: 100%; border-radius: 10px; margin-top: 10px; display: none; }
        .text { text-align: left; background: #eee; padding: 15px; margin: 15px 0; border-radius: 8px; line-height: 1.6; }
        button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        #s { background: #e53e3e; color: white; }
        #st { background: #4a5568; color: white; }
    </style>
</head>
<body>
    <div class="box">
        <h2 id="t">è¼‰å…¥æ•™æ...</h2>
        <img id="i" src="">
        <input type="text" id="n" placeholder="å­¸ç”Ÿå§“å" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box;">
        <div id="tx" class="text">æ­£åœ¨å¾è©¦ç®—è¡¨åŒæ­¥è³‡æ–™...</div>
        <audio id="ta"></audio>
        <button id="s">ğŸ”´ é–‹å§‹éŒ„éŸ³ (Start)</button>
        <button id="st" disabled>â¹ï¸ åœæ­¢ä¸¦å‚³é€ (Stop)</button>
        <p id="msg" style="font-weight:bold;"></p>
    </div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbznQwq6elMdN5qUyApqv2aeIWyWS2MiZBaU-I1NSt8f-eBpYQBa61VFI0jUtKKUGwAbIw/exec";

    async function load() {
        try {
            const r = await fetch(GAS_URL);
            const d = await r.json();
            document.getElementById('t').innerText = d.title;
            document.getElementById('tx').innerText = d.text;
            document.getElementById('ta').src = d.audio;
            if(d.media_url) {
                const img = document.getElementById('i');
                img.src = d.media_url;
                img.style.display = 'block';
            }
        } catch(e) { 
            document.getElementById('tx').innerText = "é€£ç·šå¤±æ•—ï¼šè«‹æª¢æŸ¥ GAS éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œæ‰€æœ‰äººã€ã€‚"; 
        }
    }
    load();

    let rec, chunks = [];
    document.getElementById('s').onclick = async () => {
        if(!document.getElementById('n').value) return alert("è«‹è¼¸å…¥å§“å");
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        rec = new MediaRecorder(stream);
        rec.ondataavailable = e => chunks.push(e.data);
        rec.onstop = async () => {
            document.getElementById('msg').innerText = "ğŸš€ å‚³é€ä¸­...";
            const blob = new Blob(chunks, { type: 'audio/webm' });
            const reader = new FileReader();
            reader.readAsDataURL(blob);
            reader.onloadend = async () => {
                await fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ audio: reader.result.split(',')[1], name: document.getElementById('n').value }) });
                document.getElementById('msg').innerText = "âœ… å·²æˆåŠŸå‚³é€çµ¦ Jackie è€å¸«ï¼";
            };
        };
        document.getElementById('ta').play();
        rec.start();
        document.getElementById('s').disabled = true;
        document.getElementById('st').disabled = false;
        document.getElementById('msg').innerText = "ğŸ”´ æ­£åœ¨è½è®€ç·´ç¿’ä¸­...";
    };

    document.getElementById('st').onclick = () => {
        rec.stop();
        document.getElementById('ta').pause();
        document.getElementById('ta').currentTime = 0;
        document.getElementById('s').disabled = false;
        document.getElementById('st').disabled = true;
    };
</script>
</body>
</html>
