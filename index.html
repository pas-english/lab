<!DOCTYPE html><html lang="zh-TW"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G8 Lab</title>
    <style>
        :root { --primary: #00ff88; --bg: #1a1d23; --card: #252932; --text: #e0e6ed; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .studio-container { background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 500px; width: 100%; text-align: center; }
        .reading-text { background: #2d333d; border: 1px solid #444; padding: 15px; border-radius: 12px; text-align: left; font-size: 18px; line-height: 1.6; margin: 20px 0; min-height: 100px; white-space: pre-wrap; }
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        input, select { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #444; background: #1a1d23; color: #fff; }
        .btn-box { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
        #startBtn { background: #e53e3e; color: #fff; }
        #stopBtn { background: #4a5568; color: #fff; }
        #uploadBtn { background: var(--primary); color: #000; grid-column: span 2; display: none; margin-top: 10px; }
        .status { margin-top: 10px; color: var(--primary); font-size: 14px; }
    </style></head><body><div class="studio-container">
    <h2 style="color: var(--primary); margin-top: 0;">JACKIE LAB (G8)</h2>
    <div class="input-row">
        <select id="lessonSelect" onchange="switchLesson()">
            <option value="ch1">Chapter 1</option>
            <option value="ch2">Chapter 2</option>
            <option value="ch3">Chapter 3</option>
        </select>
        <input type="text" id="studentName" placeholder="Ëº∏ÂÖ•Ëã±ÊñáÂßìÂêç">
    </div>
    <div class="reading-text" id="lessonText">ËºâÂÖ•‰∏≠...</div>
    <audio id="teacherAudio" src="" preload="auto" crossorigin="anonymous" playsinline></audio>
    <div class="btn-box">
        <button id="startBtn" class="btn">üî¥ START</button>
        <button id="stopBtn" class="btn" disabled>‚èπ STOP</button>
        <button id="uploadBtn" class="btn">üì§ SEND</button>
    </div>
    <p id="status" class="status">READY</p>
    <audio id="audioPlayer" controls style="display: none; width: 100%; margin-top: 10px;"></audio>
</div><script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbznQwq6elMdN5qUyApqv2aeIWyWS2MiZBaU-I1NSt8f-eBpYQBa61VFI0jUtKKUGwAbIw/exec"; 
    const lessons = {
        "ch1": { text: "The children loved the house. They knew immediately that they were going to be happy there. It was deep in the country and after two years in London, the children thought that it was wonderful.", audio: "../5 children and it - ch1 shadowing.mp3" },
        "ch2": { text: "The children were angry and unhappy, but the policeman walked along the road behind them and they couldn‚Äôt escape.", audio: "../5 children and it - ch2 shadowing.mp3" },
        "ch3": { text: "The next day was very wet. It rained all day and the children could not go to see the Psammead.", audio: "../5 children and it - ch3 shadowing.mp3" }
    };
    function switchLesson() {
        const data = lessons[document.getElementById('lessonSelect').value];
        document.getElementById('lessonText').innerText = data.text;
        document.getElementById('teacherAudio').src = data.audio;
        document.getElementById('status').innerText = "Â∑≤ËºâÂÖ• " + document.getElementById('lessonSelect').value;
    }
    window.onload = switchLesson;
    let recorder, chunks = [], audioContext, dest, stream;
    document.getElementById('startBtn').onclick = async () => {
        if (!document.getElementById('studentName').value.trim()) return alert("Ë´ãËº∏ÂÖ•ÂßìÂêç");
        try {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            dest = audioContext.createMediaStreamDestination();
            stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            const micSource = audioContext.createMediaStreamSource(stream);
            micSource.connect(dest);
            const teacherAudio = document.getElementById('teacherAudio');
            const teacherSource = audioContext.createMediaElementSource(teacherAudio);
            teacherSource.connect(dest); teacherSource.connect(audioContext.destination);
            recorder = new MediaRecorder(dest.stream);
            recorder.ondataavailable = e => chunks.push(e.data);
            recorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/webm' });
                document.getElementById('audioPlayer').src = URL.createObjectURL(blob);
                document.getElementById('audioPlayer').style.display = 'block';
                document.getElementById('uploadBtn').style.display = 'block';
            };
            chunks = []; teacherAudio.currentTime = 0; teacherAudio.play(); recorder.start();
            document.getElementById('startBtn').disabled = true; document.getElementById('stopBtn').disabled = false;
            document.getElementById('status').innerText = "üî¥ ÈåÑÈü≥‰∏≠...";
        } catch (err) { alert("ÈåØË™§Ôºö" + err); }
    };
    document.getElementById('stopBtn').onclick = () => {
        recorder.stop(); document.getElementById('teacherAudio').pause();
        document.getElementById('startBtn').disabled = false; document.getElementById('stopBtn').disabled = true;
        stream.getTracks().forEach(t => t.stop());
    };
    document.getElementById('uploadBtn').onclick = async () => {
        document.getElementById('status').innerText = "üöÄ ÂÇ≥ÈÄÅ‰∏≠...";
        const blob = await fetch(document.getElementById('audioPlayer').src).then(r => r.blob());
        const reader = new FileReader(); reader.readAsDataURL(blob);
        reader.onloadend = async () => {
            const base64 = reader.result.split(',')[1];
            await fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({
                audio: base64, className: "G8", name: document.getElementById('studentName').value + "_" + document.getElementById('lessonSelect').value
            })});
            document.getElementById('status').innerText = "‚úÖ ÊàêÂäüÔºÅ";
        };
    };
</script></body></html>
